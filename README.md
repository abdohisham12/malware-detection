# üõ°Ô∏è Malware Detection Project

## Overview
a Malware Detection machine learning model aims to predict the likelihood of a Windows machine getting infected by various families of malware. Using telemetry data from Windows Defender, which includes machine configurations, operating system details, and antivirus product states, the project utilizes a stacked model approach to enhance detection accuracy with model accuracy of 0.6698 where the highest model accuracy in kaggle was 0.7114 .

### Stacked Model Approach
The project combines the following machine learning models:
- **Random Forest**: Aggregates predictions from multiple decision trees for improved accuracy and reduced overfitting.   
- **XGBoost**: handle outliers by  gradient boosting run on large datasets efficiently.   
- **LightGBM**: using leaf-wise tree growth to improve performance on large-scale data.

    ![malware detection overview](https://github.com/user-attachments/assets/20ae4664-f610-415e-a45b-30e590b305d5)


## Table of Contents
- [Overview](#overview)
- [Usage](#usage)
- [Project Structure](#project-structure)
- [Model Details](#model-details)
- [Installation](#installation)
- [Contributing](#contributing)
- [Acknowledgments](#acknowledgments)


## Usage

To run the project and use the provided notebooks:

1. Navigate to the repository directory: `cd Malware-Detection`
2. Start Jupyter Notebook: `jupyter notebook`
3. Download the dataset: You can obtain the dataset from the Microsoft Malware Prediction Competition on Kaggle: [here](https://www.kaggle.com/competitions/microsoft-malware-prediction/data).
   - Alternatively, you can use this direct link to download the dataset: [[link to the dataset file](https://storage.googleapis.com/kaggle-competitions-data/kaggle-v2/10683/220065/bundle/archive.zip?GoogleAccessId=web-data@kaggle-161607.iam.gserviceaccount.com&Expires=1726326045&Signature=NAppNQjKNskUDDXPhVWufJrR%2BvRl4WAsasHA2XxVTLrrmGNFH4wTvwZDOrHdb2Sy%2BOA%2F%2BLOzlQeLvln4igi3fM4ka9aZr4KzdL3SKSjxmB3a%2FPyHmykq4X3FrxaCOGEzm9sx6YYUCwfvO5iy8fSjY5mZGIov7pBmNvcKhRkdGXy9vO2WK17GD3t%2BEbWiZbv2UFyyIiAOsrTHCW2%2FI8EZvV4Thbsis%2FhshoHG2Fo2v2kAvE8QwT%2BEwxwbXL79yxIlSVGvSJEelyL4upwmjz5Xz0GsX8WJpvxS7EM6IAAUSpEICwyeveH6R45nWenjc7OOLCUf1QdkULAXqrqA6r2sSQ%3D%3D&response-content-disposition=attachment%3B+filename%3Dmicrosoft-malware-prediction.zip)]
4. Open the notebooks: In Jupyter Notebook, open the provided `.ipynb` files and execute the cells to run the code. Note that preprocessing or dataset formatting might be required before running the notebooks.    

## Project Structure

Malware-Detection/

‚îú‚îÄ‚îÄ data/                                  # Dataset files.   
‚îú‚îÄ‚îÄ models/                                # Saved trained models.   
‚îú‚îÄ‚îÄ stacked-model-on-all-rows.ipynb        # Main notebook .      
‚îî‚îÄ‚îÄ  README.md                             # Project documentation.   

## Model Details
The project uses a stacked model approach with the following components:
### models
Random Forest: provide roc auc score of 0.6681.      
XGBoost:  handles outliers effectively and provide auc score of 0.6352 .      
LightGBM: provide roc auc score of 0.6692 .    
Stacking model : used logisitic regression model to collect output of all 3 models and push it in one model to imporove roc score to 0.6698.   

abdulrahman tried different classification model including 
SVC which took 4 hour to run on a 100k row sample of the data.    
KNN where best K was determined by GridSearchCV (best k was 30 ) and raised rocauc score of 0.62.   
logisitic regression raised rocauc score of 0.6153.    
### hyperparameters tuning
random forest hyperparameters is made on MLflow.   
before hyperparameter tuning.   
![rf roc score ](https://github.com/user-attachments/assets/a3d40e68-0aba-4374-adda-53decee5f7e5)


after ![random forest](https://github.com/user-attachments/assets/7e0bc817-0d9d-43bf-8d65-42022829fa2a)


 XGboost is also made on MLflow 
 ![xgboost](https://github.com/user-attachments/assets/90407b6e-25e6-42c6-b2d1-292d91b6f661)


LightGBM is determined by GridSearchCV ran on a 100k row sample of the data

### Evaluation Metric
ROC-AUC is used as the evaluation metric to assess model performance, particularly suitable for imbalanced datasets and the needed metric score to sumbit in kaggle competition .

## Installation
To set up the project locally, follow these steps:

### Step 1: Clone the repository

```bash
git clone https://github.com/yourusername/Malware-Detection.git
```
### Step 2 : Set up the environment

Create a Conda environment and install the required dependencies:
```bash
conda create --name malware_detection python=3.11.8     
conda activate malware_detection   
pip install pandas numpy scikit-learn lightgbm xgboost category-encoders statsmodels matplotlib seaborn   
```

## Contributing
Abdulrahman weclomes Contributions, To contribute, please fork the repository and submit a pull request with your proposed changes.


## Acknowledgments
This project is based on the Microsoft Malware Prediction Competition on Kaggle. Special thanks to the following tools and libraries used:

Pandas.   
NumPy.   
Scikit-learn.   
LightGBM.   
XGBoost.   
Category Encoders.   
Statsmodels.   
Matplotlib.   
Seaborn.   
